"use strict";!function(){function a(a){this.tabType=1,this.username=a.username,this.nickname=a.nickname,this.avatar=a.avatar,this.alreadyHaveCount=99,this.haveListReady=this.allListReady=!1,this.options=a,this.allMedalList=[],this.haveMedalList=[],this.spmMap=[{type:"创作",name:["持之以恒","1024勋章","1024超级勋章","勤写标兵Lv1","勤写标兵Lv2","博客之星","原力探索","原力突破","原力王者","学习力","原力新人","原力探索","原力突破"],spm:"3001.4299"},{type:"贡献",name:["分享学徒","分享小兵","分享达人","分享精英","分享宗师","分享王者","至尊王者"],spm:"3001.4300"}],this.getData()}var e="http"===location.protocol.substr(0,4)?"":"https:",t=e+"//g.csdnimg.cn/user-medal/1.0.3/user-medal.css",n="https://g-api.csdn.net";!function(a){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=a,document.getElementsByTagName("head")[0].appendChild(e)}(t),a.prototype={constructor:a,init:function(){this.haveListReady&&this.allListReady&&(this.setReportPoint(),this.renderMain(),this.renderTab(),this.renderNav())},close:function(){this.$box&&this.$box.remove()},setReportPoint:function(){var a=this;try{this.spmMap=this.spmMap.reduce(function(a,e){return e.name.forEach(function(t){a[t]={name:t,spm:e.spm,type:e.type}}),a},{}),this.allMedalList=this.allMedalList.map(function(e,t){return e.medals=e.medals.map(function(n){var s=a.spmMap[n.name]||{};return n.mod="1595992524_00"+(t+1),s.spm&&(n.spm=s.spm),a.spmMap[n.name]=Object.assign({},s,{mod:n.mod,type:e.name,name:n.name}),n}),e}),this.haveMedalList=this.haveMedalList.map(function(e){var t=a.spmMap[e.name]||{};return Object.assign({},e,t)})}catch(a){void 0}},renderMain:function(){var a=this,e=$('<div id="user-medal">\n          <div class="user-medal-container">\n            <div class="user-medal-head"> \n              <img src="'+a.avatar+'">\n              <span class="user-medal-close"></span>\n            </div>\n            <div class="user-medal-body">\n              <div class="user-medal-content medal-clearfix">\n                <div class="medal-content-body"></div>\n              </div>\n            </div>\n          </div>\n        </div>');a.$box=e,e.find(".user-medal-close").click(function(){a.close()}),e.on("click",function(e){$(e.target).find(".user-medal-container").length&&a.close()}),$("body").find("#user-medal").remove(),$("body").append(e)},renderTab:function(){var a=this,e=$('<div class="user-medal-tab medal-clearfix">\n                <p class="medal-fl medal-user-info">\n                  <span class="medal-name">'+a.nickname+'</span>\n                  <span class="medal-count">已经获得'+a.alreadyHaveCount+'枚勋章啦</span>\n                </p>\n                <p class="medal-fr medal-user-btns">\n                  <span class="medal-btn medal-btn-tab" data-type=1>已拥有</span>\n                  <span class="medal-btn medal-btn-tab" data-type=2>成就勋章</span>\n                </p>\n              </div>');e.find(".medal-user-btns .medal-btn").click(function(e){$(this).hasClass("medal-btn-red")||(a.tabType=$(this).data("type"),a.toggleNav(),1===a.tabType?a.renderMedal(a.haveMedalList):a.$nav.find("li").first().click(),$(this).addClass("medal-btn-red").siblings().removeClass("medal-btn-red"))}),this.$box.find(".user-medal-body").prepend(e),this.$box.find(".medal-btn-tab[data-type="+this.tabType+"]").click()},toggleNav:function(){this.$nav&&this.$nav.toggle()},renderNav:function(){var a=this,e=a.allMedalList;if(e){var t=$('<ul class="medal-content-nav medal-fl"></ul>');e.forEach(function(a,e){t.append('<li class="medal-nav-item" data-list-index='+e+'><img src="'+a.icon+'" />'+a.name+"<span>("+a.haveCount+"/"+a.totalCount+")</span></li>")}),t.on("click","li",function(e){var t=$(this),n=t.data("list-index");t.addClass("active").siblings().removeClass("active"),a.renderMedal(a.allMedalList[n].medals)}),a.$nav=t,a.$box.find(".user-medal-content").prepend(t),a.toggleNav()}},renderMedal:function(a,e){var t="",n=this.isSelf();a="string"==typeof a?JSON.parse(a):a,a.forEach(function(a){var e=a.mod?{mod:a.mod,extend1:a.name}:{};a.spm&&(e.spm=a.spm),t+='<div class="medal-detail-item">\n                <img src="'+a.imageUrl+'">\n                <p class="medal-detail-item-title">'+a.name+'</p>\n                <p class="medal-detail-item-desc">'+a.description+"</p>\n                "+(a.sourceUrl?'<a href="'+a.sourceUrl+'" '+(a.mod?"data-report-click="+JSON.stringify(e):"")+" "+(a.spm?'data-report-query="spm='+a.spm+'"':"")+'  target="_blank" class="medal-detail-item-btn">'+(n?"去获得":"我也要")+"</a>":'<a class="medal-detail-item-btn" style="visibility:hidden">隐藏<a/>')+"\n              </div>"}),0===a.length&&(t='<div class="medal-detail-item-empty"></div>'),this.$box.find(".medal-content-body").html(t)},getCookie:function(a){var e={};return document.cookie.replace(/([^=;\s]+)=([^=;\s]+)/g,function(){for(var a=arguments.length,t=Array(a),n=0;n<a;n++)t[n]=arguments[n];var s=t[1],i=t[2];e[s]=i}),a?e[a]:e},isSelf:function(){return this.username===this.getCookie("username")},getHaveMedalList:function(){var a=this;$.ajax({url:n+"/user-medal/v1/medal/get/alreadyHave",type:"get",data:{username:a.username},contentType:"application/json",dataType:"json",success:function(e){e.data&&(a.haveMedalList=e.data,a.haveListReady=!0,a.init())},error:function(a){}})},getAllMedalList:function(){var a=this;$.ajax({url:n+"/user-medal/v1/medal/get/all",type:"get",data:{username:a.username},contentType:"application/json",dataType:"json",success:function(e){e.data&&(a.allMedalList=e.data.medalList,a.alreadyHaveCount=e.data.alreadyHaveCount,a.allListReady=!0,a.init())},error:function(a){}})},getData:function(){this.getHaveMedalList(),this.getAllMedalList()}},window.csdn=window.csdn||{},window.csdn.userMedal={show:function(e){return new a(e)}},$(document).on("click","[csdn-user-medal-btn=true], .csdn-user-medal-btn",function(a){var e=$(this),t=e.data("username"),n=e.data("nickname"),s=e.data("avatar");n&&t&&s&&window.csdn.userMedal.show({username:t,avatar:s,nickname:n})})}();