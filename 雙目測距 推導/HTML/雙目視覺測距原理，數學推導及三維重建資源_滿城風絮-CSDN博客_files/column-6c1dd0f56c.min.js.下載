$(function(){function t(){g="https://csdnimg.cn/release/download/images/pay_error.png",w="已扫码<br>请在手机端操作",$("#payCode").html('<div class="renovate"><img src="'+g+'"><span>'+w+"</span></div>"),$("#payCodeImg").html('<img class="repeat-again" src="'+g+'"><span class="text">'+w+"</span>")}function e(e){var c={goods_id:e,flag:17,request_type:4,success_function:a,error_function:o,timeout_function:i,get_pay_success_callback:n,is_use_balance:l,payment_function:t};$("#payCode").html(C),$("#payCodeImg").html(x),cart.qrPay(c)}function a(t,e){f?r("payCode",e.pay_url):r("payCodeImg",e.pay_url),m=e.pay_url}function n(){y.boxshadow.fadeOut(function(){showToast({text:"支付成功",bottom:"10%",zindex:9e3,speed:500,time:1500}),window.location.reload(),y.payCode.fadeOut(function(){window.location.reload()})})}function o(t){showToast({text:t.errorMessage,bottom:"10%",zindex:9e3,speed:500,time:1500})}function i(){f?y.payCode.find("#payCode").html(k):y.getPay.find("#payCodeImg").html(v)}function c(t){switch(t){case"column":l?d(_,u)>0?$(".now-price").text("¥"+d(_,u)):$(".now-price").text("¥0"):$(".now-price").text("¥"+_);break;case"details":var e=$(".pay-money-span").attr("data-oldprice");l?d(e,u)>0?($(".pay-money-span").text(d(e,u)+"元"),s(!1,330)):($(".pay-money-span").text("0元"),s(!0,202)):($(".pay-money-span").text($(".pay-money-span").attr("data-oldprice")+"元"),s(!1,330))}}function s(t,e){y.payCode.css({height:e+"px"}),t?(y.payCode.find(".content-code").hide(),y.payCode.find(".content-blance").show()):(y.payCode.find(".content-blance").hide(),y.payCode.find(".content-code").show())}function d(t,e){var a=Number(t)-Number(e);return a>0?a.toFixed(2):a<0?a.toFixed(2):a}function p(t,a){$.ajax({type:"GET",url:"https://order.csdn.net/api/app/v1/getBalance",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){u=n.data.balance,I++,I<=1&&(0==u?(l=0,$(".pay-code-radio").prop("disabled",!0)):(l=1,$(".pay-code-radio").attr("checked",!0))),$(".pay-balance .balance").text(u),$(".pay-code-balance .balance").text(u),c(a),e(t)}})}function r(t,e){var a=qrcode(6,"M");a.addData(e),a.make(),$("#"+t).html(a.createImgTag(3,3)),$("#"+t).html($("#"+t).html()),f&&y.boxshadow.fadeIn(function(){y.payCode.fadeIn()})}var l=0,u=0,m="";$(document).on("click",".tip-subscribe-column>span",function(){$(this).parent().find(".tip").fadeIn()}),$(document).on("click",".tip-subscribe-column .bt-close",function(){$(".tip-subscribe-column").find(".tip").fadeOut()});var b="",y={boxshadow:$(".skin-boxshadow"),btClose:$(".bt-close"),payCode:$(".pay-code"),btSubscribe:$(".bt-subscribe-article"),btSubscribeColumn:$(".bt-subscribe-text"),getPay:$(".get-pay")},f=!1,h=window.location.href;h.indexOf("category_")>-1&&!f&&getCookie("UserName")&&y.btSubscribeColumn.length&&(b=y.getPay.data("id"),p(y.getPay.data("id"),"column")),$(document).on("click",".bt-subscribe",function(){getCookie("UserName")||window.csdn.loginBox.show()}),y.getPay.on("click",function(){f=!1,b=$(this).data("id"),e(b)}),$(document).on("click",".bt-subscribe-article",function(){f=!0,$(".pay-money-span").text($(".pay-money-span").data("nowprice")),getCookie("UserName")?(b=$(this).data("id"),p(b,"details")):window.csdn.loginBox.show()}),$(document).on("click","#bt-click",function(){f=!0,getCookie("UserName")?(b=$(this).data("id"),p(b,"details")):window.csdn.loginBox.show()}),y.payCode.on("click",".renovate",function(){e(b||$(this).parent().data("id"))}),y.btClose.on("click",function(){y.payCode.fadeOut(function(){y.boxshadow.fadeOut()})});var g=blogStaticHost+"dist/pc/img/pay-time-out.png",w="获取中",x='<img class="repeat-again" src="'+g+'"><span class="text">'+w+"</span>",C='<div class="renov-men"><img src="'+g+'"><span>'+w+"</span></div>",k='<div class="renovate">    <img src="'+blogStaticHost+'dist/pc/img/pay-time-out.png">    <span>点击重新获取</span></div>',v='<img class="repeat-again" src="'+blogStaticHost+'dist/pc/img/pay-time-out.png"><span class="text">点击重新获取</span>';$(".now-price").text();$(".pay-code-radio").click(function(){var t=$(this).attr("name"),e=$(this).attr("checked");$("input:radio[name='"+t+"']").attr("checked",!1),$(this).attr("checked",!0),l=1,"checked"==e&&(l=0,$(this).attr("checked",!1)),p(b,$(this).attr("data-type"))});var _=$(".subscribe-price .now-price").text().slice(1),I=0;y.payCode.on("click",".blance-bt",function(){window.location.href=m})});